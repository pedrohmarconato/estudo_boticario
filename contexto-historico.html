<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline COVID-19 Brasil - Cont√°gios, Mortes e A√ß√µes Governamentais</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* CSS inline - Estilo Consultoria McKinsey/Bain */
        :root {
            --azul-marinho: #011E38;
            --off-white: #F5F1EB;
            --azul-royal: #264FEC;
            --salmao: #FFBC82;
            --rosa-pink: #FF69B4;
            --font-primary: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --cinza-claro: #F8F9FA;
            --cinza-medio: #6C757D;
            --verde-consultoria: #0A6847;
            --covid-casos: #FF6B6B;
            --covid-mortes: #4ECDC4;
            --covid-recuperados: #45B7D1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(135deg, var(--azul-marinho) 0%, #003366 100%);
            color: var(--off-white);
            line-height: 1.4;
            font-size: 14px;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Header - Estilo Consultoria */
        .slide-header {
            background: rgba(245, 241, 235, 0.98);
            backdrop-filter: blur(10px);
            padding: 15px 40px;
            border-bottom: 3px solid var(--salmao);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .slide-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Bot√µes laterais de navega√ß√£o */
        .nav-lateral {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            z-index: 9999;
            background: var(--azul-royal);
            color: white;
            border: none;
            padding: 20px 16px;
            font-size: 28px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(38, 79, 236, 0.4);
        }

        .nav-lateral:hover {
            background: var(--azul-marinho);
            transform: translateY(-50%) scale(1.05);
        }

        .nav-lateral.prev {
            left: 20px;
            border-radius: 0 12px 12px 0;
        }

        .nav-lateral.next {
            right: 20px;
            border-radius: 12px 0 0 12px;
        }

        .nav-lateral.disabled {
            background: var(--cinza-medio);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .nav-lateral.disabled:hover {
            background: var(--cinza-medio);
            transform: translateY(-50%);
        }

        .slide-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--azul-marinho);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .slide-meta {
            font-size: 12px;
            color: var(--cinza-medio);
            display: flex;
            gap: 20px;
        }

        /* Container Principal */
        .slide-container {
            position: relative;
            z-index: 100;
            margin-top: 70px;
            padding: 20px 20px;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
            pointer-events: none;
        }

        .slide-container > * {
            pointer-events: auto;
        }

        /* T√≠tulo Principal */
        .slide-main-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--off-white);
            margin-bottom: 8px;
            line-height: 1.2;
            border-left: 4px solid var(--salmao);
            padding-left: 20px;
            animation: slideInLeft 0.8s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .slide-subtitle {
            font-size: 18px;
            color: var(--salmao);
            margin-bottom: 20px;
            padding-left: 24px;
            font-weight: 500;
            animation: slideInLeft 0.8s ease-out 0.2s both;
        }
        
        /* Executive Summary */
        .executive-summary {
            background: rgba(1, 30, 56, 0.95);
            border-left: 4px solid var(--salmao);
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            animation: slideInUp 0.8s ease-out 0.4s both;
        }
        
        .summary-text {
            font-size: 14px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            margin: 0;
            text-align: justify;
        }
        
        .summary-text strong {
            color: var(--salmao);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 11px;
        }

        /* Gr√°fico de Fundo Integrado */
        .background-chart {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100vw;
            height: calc(100vh - 60px);
            z-index: 1;
            opacity: 0.3;
            pointer-events: none;
        }

        /* Container do Gr√°fico Overlay */
        .chart-container {
            background: transparent;
            backdrop-filter: none;
            border: none;
            border-radius: 0;
            padding: 40px 0;
            margin-top: 20px;
            margin-bottom: 20px;
            box-shadow: none;
            position: relative;
            z-index: 200;
        }

        .chart-header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 188, 130, 0.3);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--off-white);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            justify-self: start;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-self: end;
            z-index: 1000;
            position: relative;
        }

        .toggle-btn {
            background: var(--azul-royal);
            color: white;
            border: none;
            padding: 6px 12px;
            font-size: 10px;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .toggle-btn:hover {
            background: var(--azul-marinho);
            transform: translateY(-2px);
        }

        .toggle-btn.active {
            background: var(--salmao);
            color: var(--azul-marinho);
        }

        /* Legenda do Gr√°fico */
        .chart-legend {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #FFFFFF;
            font-weight: 600;
            opacity: 1;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            background: rgba(1, 30, 56, 0.7);
            padding: 4px 12px;
            border-radius: 4px;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .legend-casos { background: var(--covid-casos); }
        .legend-mortes { background: var(--covid-mortes); }
        .legend-marcos { background: var(--azul-royal); }

        /* SVG Styles - Gr√°fico de Fundo */
        .background-chart svg {
            width: 100%;
            height: 100%;
        }

        /* SVG Styles - Gr√°fico Overlay */
        .timeline-chart {
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            border: none;
            margin-top: -30px;
            position: relative;
            z-index: 1;
        }

        /* Estilos para gr√°fico de fundo */
        .background-chart .line-casos {
            fill: none;
            stroke: var(--covid-casos);
            stroke-width: 3;
            opacity: 0.2;
            filter: blur(1px);
            animation: pulse-line 4s ease-in-out infinite;
        }

        .background-chart .line-mortes {
            fill: none;
            stroke: var(--covid-mortes);
            stroke-width: 3;
            opacity: 0.2;
            filter: blur(1px);
            animation: pulse-line 4s ease-in-out infinite 2s;
        }

        .background-chart .area-casos {
            fill: none;
            opacity: 0;
        }

        .background-chart .area-mortes {
            fill: none;
            opacity: 0;
        }

        @keyframes pulse-line {
            0%, 100% { opacity: 0.2; stroke-width: 3; }
            50% { opacity: 0.35; stroke-width: 4; }
        }

        /* Adicionar anima√ß√£o suave nas linhas */
        @keyframes drawLine {
            to {
                stroke-dashoffset: 0;
            }
        }

        .line-casos,
        .line-mortes {
            stroke-dasharray: 3000;
            stroke-dashoffset: 3000;
            animation: drawLine 2s ease-out forwards;
        }

        .line-mortes {
            animation-delay: 0.5s;
        }

        /* Adicionar transi√ß√µes para os eixos */
        .axis, .axis-label {
            transition: opacity 0.3s ease;
        }

        /* Estilo para tipo de marco */
        .milestone-dot.marco-importante {
            fill: var(--rosa-pink);
        }

        .milestone-dot.vacinacao {
            fill: var(--verde-consultoria);
        }

        .milestone-dot.flexibilizacao {
            fill: var(--azul-royal);
        }

        /* Estilo para hover em todo o gr√°fico */
        .chart-container:hover .data-point {
            opacity: 0.6;
        }

        .chart-container:hover .milestone-label {
            opacity: 1;
        }

        .chart-container:hover .milestone-category {
            opacity: 0.9;
        }

        /* Estilos para gr√°fico overlay */
        .line-casos {
            fill: none;
            stroke: var(--covid-casos);
            stroke-width: 2.5;
            filter: drop-shadow(0 0 8px rgba(255, 107, 107, 0.5));
            opacity: 0.9;
        }

        .line-mortes {
            fill: none;
            stroke: var(--covid-mortes);
            stroke-width: 2.5;
            filter: drop-shadow(0 0 8px rgba(78, 205, 196, 0.5));
            opacity: 0.9;
        }

        .area-casos {
            fill: none;
            opacity: 0;
        }

        .area-mortes {
            fill: none;
            opacity: 0;
        }

        .axis {
            color: var(--off-white);
            font-size: 13px;
            opacity: 0.6;
            font-weight: 400;
            font-family: var(--font-primary);
        }

        .axis path {
            stroke: var(--off-white);
            opacity: 0.15;
            stroke-width: 1;
        }

        .axis line {
            stroke: var(--off-white);
            opacity: 0.1;
            stroke-width: 1;
        }

        .axis text {
            fill: var(--off-white);
            opacity: 0.8;
            font-weight: 500;
        }

        .axis-label {
            font-size: 15px;
            font-weight: 600;
            fill: var(--off-white);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .grid-line {
            stroke: var(--off-white);
            stroke-width: 0.5;
            opacity: 0.05;
            stroke-dasharray: 2,4;
        }

        /* Marcos Governamentais */
        .milestone {
            cursor: pointer;
        }

        .milestone-line {
            stroke: var(--salmao);
            stroke-width: 2;
            stroke-dasharray: none;
            opacity: 0.7;
        }

        .milestone-dot {
            transition: filter 0.3s ease, transform 0.3s ease;
            filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.4));
            transform-origin: center;
        }

        .milestone-group:hover .milestone-dot {
            transform: scale(1.12);
            filter: drop-shadow(0 0 8px rgba(255, 188, 130, 0.8));
            z-index: 1;
        }

        .milestone-group:hover .milestone-dot.marco-importante {
            filter: drop-shadow(0 0 12px rgba(255, 105, 180, 1));
        }

        .milestone-group:hover .milestone-dot.vacinacao {
            filter: drop-shadow(0 0 10px rgba(10, 104, 71, 0.8));
        }

        .milestone-group:hover .milestone-dot.flexibilizacao {
            filter: drop-shadow(0 0 10px rgba(38, 79, 236, 0.8));
        }

        .milestone-group:hover .milestone-label {
            opacity: 1 !important;
            font-weight: 700;
        }

        .milestone-group:hover .milestone-label-bg {
            fill: rgba(1, 30, 56, 0.95);
        }

        .milestone-label {
            font-size: 11px;
            font-weight: 600;
            fill: var(--off-white);
            opacity: 0.7;
            text-shadow: 1px 1px 2px rgba(1, 30, 56, 0.9);
            letter-spacing: 0.3px;
            transition: opacity 0.3s ease, font-weight 0.3s ease;
        }

        .milestone-label-bg {
            fill: rgba(1, 30, 56, 0.85);
            rx: 3;
            ry: 3;
            filter: blur(0.5px);
        }

        /* Estilo McKinsey/Bain para labels */
        .milestone-category {
            font-size: 9px;
            font-weight: 400;
            fill: var(--salmao);
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(1, 30, 56, 0.95);
            color: var(--off-white);
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            border: 2px solid var(--salmao);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 250px;
            z-index: 1000;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip-title {
            font-weight: 700;
            color: var(--salmao);
            margin-bottom: 8px;
            font-size: 13px;
        }

        .tooltip-content {
            line-height: 1.4;
        }

        /* Estat√≠sticas Resumo */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 30px;
            position: relative;
            z-index: 300;
        }

        .stat-card {
            background: rgba(1, 30, 56, 0.85);
            backdrop-filter: blur(15px);
            border: 2px solid var(--azul-royal);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(38, 79, 236, 0.2);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--azul-royal);
            display: block;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--azul-marinho);
            font-weight: 600;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .slide-container {
                padding: 20px;
                margin-top: 80px;
            }
            
            .slide-main-title {
                font-size: 22px;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .chart-controls {
                flex-direction: column;
                gap: 10px;
            }
        }
        /* Hover effect para todo o gr√°fico */
        .chart-container:hover .data-point {
            opacity: 0.6;
        }

        .chart-container:hover .milestone-label {
            opacity: 1;
        }

        .chart-container:hover .milestone-category {
            opacity: 0.9;
        }

        /* Controles de Navega√ß√£o Temporal - Minimalista */
        /* Controle Timeline Simples */
        .timeline-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 250px;
            justify-self: center;
            z-index: 1000;
            position: relative;
        }
        
        .timeline-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            border-radius: 3px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .timeline-slider:hover {
            opacity: 0.9;
        }
        
        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--salmao);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--off-white);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s ease;
        }
        
        .timeline-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--salmao);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--off-white);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s ease;
        }
        
        .timeline-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        .timeline-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
        }
        
        .timeline-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }
        
        .timeline-labels #current-date {
            color: var(--salmao);
            font-weight: 600;
        }

        .nav-btn {
            background: rgba(255, 188, 130, 0.1);
            color: var(--off-white);
            border: 1px solid rgba(255, 188, 130, 0.2);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .nav-btn:hover {
            background: rgba(255, 188, 130, 0.2);
            border-color: var(--salmao);
            transform: scale(1.05);
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .play-btn {
            background: rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.3);
        }

        .play-btn:hover {
            background: rgba(76, 175, 80, 0.3);
            border-color: var(--verde-consultoria);
        }

        .play-btn.playing {
            background: rgba(255, 130, 171, 0.2);
            border-color: rgba(255, 130, 171, 0.3);
        }

        .play-btn svg {
            width: 16px;
            height: 16px;
        }

        .play-btn .pause-icon {
            display: none;
        }

        /* Dashboard Button */
        .dashboard-button {
            position: fixed;
            top: 90px;
            right: 30px;
            background: rgba(245, 241, 235, 0.95);
            color: var(--azul-marinho);
            border: 1px solid rgba(38, 79, 236, 0.2);
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 500;
            text-decoration: none;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .dashboard-button:hover {
            background: rgba(38, 79, 236, 0.1);
            border-color: var(--azul-royal);
            color: var(--azul-royal);
            box-shadow: 0 4px 12px rgba(38, 79, 236, 0.2);
        }

        .dashboard-button .icon {
            font-size: 14px;
        }

        .dashboard-button .text {
            font-size: 11px;
            line-height: 1.2;
        }

    </style>
</head>
<body>
    <!-- Header Estilo Consultoria -->
    <header class="slide-header">
        <div class="slide-left">
            <h1 class="slide-title">Timeline COVID-19 Brasil - Impactos e A√ß√µes</h1>
        </div>
        <div class="slide-meta">
            <span>An√°lise Temporal Epidemiol√≥gica</span>
            <span>2020 - 2021</span>
        </div>
    </header>

    <!-- Gr√°fico de Fundo Integrado -->
    <div class="background-chart">
        <svg id="background-timeline-chart"></svg>
    </div>

    <!-- Container Principal -->
    <div class="slide-container">
        <!-- Bot√µes laterais de navega√ß√£o -->
        <a href="index.html" class="nav-lateral prev">‚Äπ</a>
        <!-- T√≠tulo Principal -->
        <h1 class="slide-main-title">Evolu√ß√£o Temporal da Pandemia COVID-19 no Brasil</h1>
        <p class="slide-subtitle">Cont√°gios, Mortes e Marcos das A√ß√µes Governamentais</p>
        
        <!-- Texto Explicativo -->
        <div class="executive-summary">
            <p class="summary-text">
                A pandemia apresentou tr√™s ondas distintas com picos em julho/2020, janeiro/2021 e abril/2021, atingindo at√© 4.000 √≥bitos/dia. As medidas governamentais (lockdowns, vacina√ß√£o, aux√≠lio emergencial) foram implementadas de forma reativa, com defasagem temporal que impactou a efic√°cia. A correla√ß√£o entre intensifica√ß√£o de restri√ß√µes e redu√ß√£o de casos evidencia a import√¢ncia do timing nas pol√≠ticas p√∫blicas de sa√∫de.
            </p>
        </div>

        <!-- Dashboard Interativo Button -->
        <a href="https://lookerstudio.google.com/embed/reporting/a2111c16-f952-4cb6-9093-2665af7e4ffd/page/TUlSF" 
           target="_blank" 
           class="dashboard-button"
           title="Abrir Dashboard Interativo no Looker Studio">
            <div class="icon">üìä</div>
            <div class="text">
                <span class="main-text">Dashboard Interativo</span>
                <span class="sub-text">Looker Studio</span>
            </div>
        </a>

        <!-- Container do Gr√°fico -->
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">Timeline Epidemiol√≥gica Interativa</h2>
                
                <!-- Controle Temporal Simples -->
                <div class="timeline-control">
                    <input type="range" 
                           class="timeline-slider" 
                           id="timeline-slider"
                           min="0" 
                           max="100" 
                           value="100" 
                           step="1">
                    <div class="timeline-labels">
                        <span>Mar/20</span>
                        <span id="current-date">Dez/21</span>
                    </div>
                </div>
                
                <div class="chart-controls">
                    <button class="toggle-btn active" id="toggle-casos">Casos</button>
                    <button class="toggle-btn active" id="toggle-mortes">Mortes</button>
                    <button class="toggle-btn active" id="toggle-marcos">Marcos</button>
                </div>
            </div>

            <!-- Legenda -->
            <div class="chart-legend">
                <div class="legend-item legend-casos">
                    <div class="legend-color legend-casos"></div>
                    <span>Casos (M√©dia 7 dias)</span>
                </div>
                <div class="legend-item legend-mortes">
                    <div class="legend-color legend-mortes"></div>
                    <span>√ìbitos (M√©dia 7 dias)</span>
                </div>
            </div>

            <!-- SVG Chart -->
            <svg class="timeline-chart" id="timeline-chart"></svg>
        </div>


    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>
    
    <!-- Bot√£o Pr√≥ximo -->
    <a href="mapa-epidemiologico.html" class="nav-lateral next">‚Ä∫</a>

    <script>
        // === DADOS COVID-19 - M√âDIAS M√ìVEIS DE 7 DIAS ===
        const covidData = [
            // 2020
            { date: new Date(2020, 2, 1), casos_media7d: 0, obitos_media7d: 0 },
            { date: new Date(2020, 2, 15), casos_media7d: 2, obitos_media7d: 0 },
            { date: new Date(2020, 2, 26), casos_media7d: 5, obitos_media7d: 0 },
            { date: new Date(2020, 3, 1), casos_media7d: 1121, obitos_media7d: 23 },
            { date: new Date(2020, 3, 15), casos_media7d: 1832, obitos_media7d: 127 },
            { date: new Date(2020, 3, 30), casos_media7d: 3506, obitos_media7d: 263 },
            { date: new Date(2020, 4, 15), casos_media7d: 11385, obitos_media7d: 749 },
            { date: new Date(2020, 4, 31), casos_media7d: 26417, obitos_media7d: 1473 },
            { date: new Date(2020, 5, 15), casos_media7d: 25982, obitos_media7d: 1238 },
            { date: new Date(2020, 5, 30), casos_media7d: 33283, obitos_media7d: 1262 },
            { date: new Date(2020, 6, 15), casos_media7d: 39483, obitos_media7d: 1233 },
            { date: new Date(2020, 6, 31), casos_media7d: 52160, obitos_media7d: 1211 },
            { date: new Date(2020, 7, 15), casos_media7d: 44235, obitos_media7d: 1175 },
            { date: new Date(2020, 7, 31), casos_media7d: 41134, obitos_media7d: 1017 },
            { date: new Date(2020, 8, 15), casos_media7d: 35643, obitos_media7d: 863 },
            { date: new Date(2020, 8, 30), casos_media7d: 31911, obitos_media7d: 729 },
            { date: new Date(2020, 9, 15), casos_media7d: 24062, obitos_media7d: 571 },
            { date: new Date(2020, 9, 31), casos_media7d: 22034, obitos_media7d: 461 },
            { date: new Date(2020, 10, 15), casos_media7d: 29070, obitos_media7d: 484 },
            { date: new Date(2020, 10, 30), casos_media7d: 38273, obitos_media7d: 620 },
            { date: new Date(2020, 11, 15), casos_media7d: 42889, obitos_media7d: 707 },
            { date: new Date(2020, 11, 31), casos_media7d: 55271, obitos_media7d: 822 },
            // 2021
            { date: new Date(2021, 0, 15), casos_media7d: 60806, obitos_media7d: 1171 },
            { date: new Date(2021, 0, 31), casos_media7d: 52544, obitos_media7d: 1119 },
            { date: new Date(2021, 1, 15), casos_media7d: 51486, obitos_media7d: 1150 },
            { date: new Date(2021, 1, 28), casos_media7d: 55095, obitos_media7d: 1293 },
            { date: new Date(2021, 2, 15), casos_media7d: 75102, obitos_media7d: 2400 },
            { date: new Date(2021, 2, 31), casos_media7d: 84670, obitos_media7d: 3158 },
            { date: new Date(2021, 3, 15), casos_media7d: 68333, obitos_media7d: 2769 },
            { date: new Date(2021, 3, 30), casos_media7d: 63430, obitos_media7d: 2595 },
            { date: new Date(2021, 4, 15), casos_media7d: 65163, obitos_media7d: 2087 },
            { date: new Date(2021, 4, 31), casos_media7d: 73453, obitos_media7d: 2071 },
            { date: new Date(2021, 5, 15), casos_media7d: 78700, obitos_media7d: 2037 },
            { date: new Date(2021, 5, 30), casos_media7d: 73602, obitos_media7d: 1972 },
            { date: new Date(2021, 6, 15), casos_media7d: 54101, obitos_media7d: 1595 },
            { date: new Date(2021, 6, 31), casos_media7d: 37948, obitos_media7d: 1139 },
            { date: new Date(2021, 7, 15), casos_media7d: 30891, obitos_media7d: 903 },
            { date: new Date(2021, 7, 31), casos_media7d: 25193, obitos_media7d: 698 },
            { date: new Date(2021, 8, 15), casos_media7d: 19970, obitos_media7d: 553 },
            { date: new Date(2021, 8, 30), casos_media7d: 14502, obitos_media7d: 451 },
            { date: new Date(2021, 9, 15), casos_media7d: 11977, obitos_media7d: 354 },
            { date: new Date(2021, 9, 30), casos_media7d: 11977, obitos_media7d: 354 },
            { date: new Date(2021, 10, 15), casos_media7d: 9983, obitos_media7d: 267 },
            { date: new Date(2021, 10, 30), casos_media7d: 8815, obitos_media7d: 236 },
            { date: new Date(2021, 11, 15), casos_media7d: 4695, obitos_media7d: 148 },
            { date: new Date(2021, 11, 30), casos_media7d: 6726, obitos_media7d: 178 }
        ];

        // === MARCOS GOVERNAMENTAIS ===
        const milestones = [
            {
                date: new Date(2020, 2, 26),
                title: "Primeiro Caso",
                description: "Primeiro caso confirmado de COVID-19 no Brasil (S√£o Paulo)",
                type: "marco-importante"
            },
            {
                date: new Date(2020, 2, 16),
                title: "Distanciamento Social",
                description: "Governo recomenda distanciamento f√≠sico baseado nas diretrizes da OMS",
                type: "acao-federal"
            },
            {
                date: new Date(2020, 2, 27),
                title: "Proibi√ß√£o Viagens",
                description: "Brasil anuncia proibi√ß√£o tempor√°ria de viajantes a√©reos estrangeiros",
                type: "acao-federal"
            },
            {
                date: new Date(2020, 3, 11),
                title: "Quarentena DF",
                description: "Distrito Federal declara medidas de distanciamento social",
                type: "acao-estadual"
            },
            {
                date: new Date(2020, 3, 24),
                title: "Quarentena SP",
                description: "Estado de S√£o Paulo imp√µe quarentena para prevenir propaga√ß√£o",
                type: "acao-estadual"
            },
            {
                date: new Date(2020, 4, 5),
                title: "Lockdown Maranh√£o",
                description: "Maranh√£o implementa regulamenta√ß√µes r√≠gidas de distanciamento social",
                type: "acao-estadual"
            },
            {
                date: new Date(2020, 4, 15),
                title: "Estados em Lockdown",
                description: "11 estados decretam lockdown para pelo menos um munic√≠pio",
                type: "acao-estadual"
            },
            {
                date: new Date(2020, 5, 1),
                title: "Aux√≠lio Emergencial",
                description: "In√≠cio do programa de aux√≠lio emergencial para fam√≠lias de baixa renda",
                type: "acao-federal"
            },
            {
                date: new Date(2020, 8, 15),
                title: "Flexibiliza√ß√£o",
                description: "In√≠cio gradual da flexibiliza√ß√£o das medidas de isolamento",
                type: "flexibilizacao"
            },
            {
                date: new Date(2020, 11, 31),
                title: "Fim Aux√≠lio Emergencial",
                description: "Programa de aux√≠lio emergencial √© encerrado em dezembro",
                type: "acao-federal"
            },
            {
                date: new Date(2021, 0, 17),
                title: "In√≠cio Vacina√ß√£o",
                description: "In√≠cio oficial da campanha de vacina√ß√£o no Brasil",
                type: "vacinacao"
            },
            {
                date: new Date(2021, 2, 15),
                title: "Pico da Pandemia",
                description: "Brasil atinge o pico de mortes di√°rias (mais de 3.000/dia)",
                type: "marco-importante"
            },
            {
                date: new Date(2021, 3, 1),
                title: "Aux√≠lio Emergencial 2",
                description: "Retorno do aux√≠lio emergencial com valores reduzidos",
                type: "acao-federal"
            },
            {
                date: new Date(2021, 6, 15),
                title: "Acelera√ß√£o Vacinas",
                description: "Intensifica√ß√£o da campanha de vacina√ß√£o em massa",
                type: "vacinacao"
            },
            {
                date: new Date(2021, 9, 31),
                title: "Fim Emerg√™ncia Sanit√°ria",
                description: "Fim do estado de emerg√™ncia sanit√°ria em v√°rias regi√µes",
                type: "flexibilizacao"
            }
        ];

        // Vari√°veis globais para o gr√°fico
        let g, lineCasos, lineMortes;
        
        // === CONFIGURA√á√ïES DO GR√ÅFICO ===
        const margin = { top: 60, right: 100, bottom: 80, left: 100 };
        const width = window.innerWidth * 0.9 - margin.left - margin.right;
        const height = (window.innerHeight * 0.6) - margin.bottom - margin.top;

        // === CONFIGURA√á√ïES DO GR√ÅFICO DE FUNDO ===
        const bgMargin = { top: 60, right: 60, bottom: 60, left: 60 };
        const bgWidth = window.innerWidth - bgMargin.left - bgMargin.right;
        const bgHeight = window.innerHeight - 60 - bgMargin.top - bgMargin.bottom;

        // === CONFIGURA√á√ÉO DO SVG DE FUNDO ===
        const bgSvg = d3.select('#background-timeline-chart')
            .attr('width', window.innerWidth)
            .attr('height', window.innerHeight - 60);

        const bgG = bgSvg.append('g')
            .attr('transform', `translate(${bgMargin.left},${bgMargin.top})`);

        // === CONFIGURA√á√ÉO DO SVG OVERLAY ===
        const svg = d3.select('#timeline-chart')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom);

        g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);

        // === ESCALAS PARA GR√ÅFICO DE FUNDO ===
        const bgXScale = d3.scaleTime()
            .domain(d3.extent(covidData, d => d.date))
            .range([0, bgWidth]);

        const bgYScaleCasos = d3.scaleLinear()
            .domain([0, d3.max(covidData, d => d.casos_media7d) * 1.1])
            .range([bgHeight, 0]);

        const bgYScaleMortes = d3.scaleLinear()
            .domain([0, d3.max(covidData, d => d.obitos_media7d) * 1.1])
            .range([bgHeight, 0]);

        // === ESCALAS PARA GR√ÅFICO OVERLAY ===
        const xScale = d3.scaleTime()
            .domain(d3.extent(covidData, d => d.date))
            .range([0, width]);

        const yScaleCasos = d3.scaleLinear()
            .domain([0, d3.max(covidData, d => d.casos_media7d) * 1.1])
            .range([height, 0]);

        const yScaleMortes = d3.scaleLinear()
            .domain([0, d3.max(covidData, d => d.obitos_media7d) * 1.1])
            .range([height, 0]);

        // === LINHAS E √ÅREAS PARA GR√ÅFICO DE FUNDO ===
        const bgLineCasos = d3.line()
            .x(d => bgXScale(d.date))
            .y(d => bgYScaleCasos(d.casos_media7d))
            .curve(d3.curveMonotoneX);

        const bgLineMortes = d3.line()
            .x(d => bgXScale(d.date))
            .y(d => bgYScaleMortes(d.obitos_media7d))
            .curve(d3.curveMonotoneX);

        const bgAreaCasos = d3.area()
            .x(d => bgXScale(d.date))
            .y0(bgHeight)
            .y1(d => bgYScaleCasos(d.casos_media7d))
            .curve(d3.curveMonotoneX);

        const bgAreaMortes = d3.area()
            .x(d => bgXScale(d.date))
            .y0(bgHeight)
            .y1(d => bgYScaleMortes(d.obitos_media7d))
            .curve(d3.curveMonotoneX);

        // === LINHAS E √ÅREAS PARA GR√ÅFICO OVERLAY ===
        lineCasos = d3.line()
            .x(d => xScale(d.date))
            .y(d => yScaleCasos(d.casos_media7d))
            .curve(d3.curveMonotoneX);

        lineMortes = d3.line()
            .x(d => xScale(d.date))
            .y(d => yScaleMortes(d.obitos_media7d))
            .curve(d3.curveMonotoneX);

        const areaCasos = d3.area()
            .x(d => xScale(d.date))
            .y0(height)
            .y1(d => yScaleCasos(d.casos_media7d))
            .curve(d3.curveMonotoneX);

        const areaMortes = d3.area()
            .x(d => xScale(d.date))
            .y0(height)
            .y1(d => yScaleMortes(d.obitos_media7d))
            .curve(d3.curveMonotoneX);

        // === RENDERIZAR GR√ÅFICO DE FUNDO ===
        function renderBackgroundChart() {
            // √Åreas de fundo - Removidas para design mais limpo
            // N√£o renderizar √°reas

            // Linhas de fundo
            bgG.append('path')
                .datum(covidData)
                .attr('class', 'line-casos')
                .attr('d', bgLineCasos);

            bgG.append('path')
                .datum(covidData)
                .attr('class', 'line-mortes')
                .attr('d', bgLineMortes);

            // Marcos de fundo (mais sutis)
            milestones.forEach(milestone => {
                const x = bgXScale(milestone.date);
                
                bgG.append('line')
                    .attr('class', 'milestone-line')
                    .attr('x1', x)
                    .attr('x2', x)
                    .attr('y1', 0)
                    .attr('y2', bgHeight)
                    .style('stroke', 'rgba(255, 188, 130, 0.15)')
                    .style('stroke-width', 0.5)
                    .style('stroke-dasharray', '4,4');
            });
        }

        // Renderizar gr√°fico de fundo
        renderBackgroundChart();

        // === GRID LINES PARA OVERLAY - Mais sutis ===
        // Grid vertical
        g.selectAll('.grid-line-x')
            .data(xScale.ticks(d3.timeMonth.every(2)))
            .enter()
            .append('line')
            .attr('class', 'grid-line')
            .attr('x1', d => xScale(d))
            .attr('x2', d => xScale(d))
            .attr('y1', 0)
            .attr('y2', height);

        // Grid horizontal para casos
        const gridCasos = g.append('g').attr('class', 'grid-casos');
        gridCasos.selectAll('.grid-line-y')
            .data(yScaleCasos.ticks(5))
            .enter()
            .append('line')
            .attr('class', 'grid-line')
            .attr('x1', 0)
            .attr('x2', width)
            .attr('y1', d => yScaleCasos(d))
            .attr('y2', d => yScaleCasos(d));

        // === √ÅREAS - Removidas para design mais limpo ===
        // N√£o renderizar √°reas preenchidas

        // === LINHAS ===
        g.append('path')
            .datum(covidData)
            .attr('class', 'line-casos')
            .attr('d', lineCasos);

        g.append('path')
            .datum(covidData)
            .attr('class', 'line-mortes')
            .attr('d', lineMortes);

        // === PONTOS DE DADOS INTERATIVOS ===
        // Pontos para casos
        const casosPoints = g.selectAll('.data-point-casos')
            .data(covidData)
            .enter()
            .append('circle')
            .attr('class', 'data-point data-point-casos')
            .attr('cx', d => xScale(d.date))
            .attr('cy', d => yScaleCasos(d.casos_media7d))
            .on('mouseover', (event, d) => showTooltip(event, d))
            .on('mouseout', hideTooltip);

        // Pontos para mortes
        const mortesPoints = g.selectAll('.data-point-mortes')
            .data(covidData)
            .enter()
            .append('circle')
            .attr('class', 'data-point data-point-mortes')
            .attr('cx', d => xScale(d.date))
            .attr('cy', d => yScaleMortes(d.obitos_media7d))
            .on('mouseover', (event, d) => showTooltip(event, d))
            .on('mouseout', hideTooltip);

        // === EIXOS ===
        const xAxis = d3.axisBottom(xScale)
            .tickFormat(d3.timeFormat('%b %Y'))
            .ticks(d3.timeMonth.every(2))
            .tickSize(5)
            .tickPadding(10);

        const yAxisCasos = d3.axisLeft(yScaleCasos)
            .tickFormat(d3.format('.2s'))
            .tickSize(5)
            .tickPadding(10);

        const yAxisMortes = d3.axisRight(yScaleMortes)
            .tickFormat(d3.format('.2s'))
            .tickSize(5)
            .tickPadding(10);

        const xAxisGroup = g.append('g')
            .attr('class', 'axis x-axis')
            .attr('transform', `translate(0,${height})`)
            .call(xAxis);

        const yAxisCasosGroup = g.append('g')
            .attr('class', 'axis y-axis-casos')
            .call(yAxisCasos);

        const yAxisMortesGroup = g.append('g')
            .attr('class', 'axis y-axis-mortes')
            .attr('transform', `translate(${width},0)`)
            .call(yAxisMortes);

        // === LABELS DOS EIXOS ===
        const xAxisLabel = g.append('text')
            .attr('class', 'axis-label')
            .attr('text-anchor', 'middle')
            .attr('x', width / 2)
            .attr('y', height + 60)
            .text('');

        const yAxisCasosLabel = g.append('text')
            .attr('class', 'axis-label y-label-casos')
            .attr('text-anchor', 'middle')
            .attr('transform', 'rotate(-90)')
            .attr('x', -height / 2)
            .attr('y', -70)
            .text('Casos Di√°rios (M√©dia 7d)');

        const yAxisMortesLabel = g.append('text')
            .attr('class', 'axis-label y-label-mortes')
            .attr('text-anchor', 'middle')
            .attr('transform', 'rotate(90)')
            .attr('x', height / 2)
            .attr('y', -width - 50)
            .text('√ìbitos Di√°rios (M√©dia 7d)');

        // === MARCOS GOVERNAMENTAIS ===
        const milestoneGroup = g.append('g')
            .attr('class', 'milestones')
            .style('opacity', 1);

        // Agrupar marcos por proximidade temporal para evitar sobreposi√ß√£o
        const groupedMilestones = [];
        let currentGroup = [];
        
        milestones.forEach((milestone, i) => {
            if (i === 0) {
                currentGroup.push(milestone);
            } else {
                const prevX = xScale(milestones[i-1].date);
                const currX = xScale(milestone.date);
                
                // Se a dist√¢ncia for menor que 80px, adiciona ao grupo atual
                if (currX - prevX < 80) {
                    currentGroup.push(milestone);
                } else {
                    // Sen√£o, cria novo grupo
                    if (currentGroup.length > 0) {
                        groupedMilestones.push(currentGroup);
                    }
                    currentGroup = [milestone];
                }
            }
        });
        if (currentGroup.length > 0) {
            groupedMilestones.push(currentGroup);
        }

        // Renderizar marcos com espa√ßamento inteligente
        console.log('Renderizando marcos iniciais:', milestones.length, 'marcos');
        
        // Sistema de posicionamento dentro do gr√°fico com alturas variadas
        const heightPercentages = [0.15, 0.25, 0.35, 0.45, 0.20, 0.30, 0.40, 0.50];
        let currentHeightIndex = 0;
        
        groupedMilestones.forEach((group, groupIndex) => {
            group.forEach((milestone, indexInGroup) => {
                const x = xScale(milestone.date);
                
                // Alternar entre diferentes alturas dentro do gr√°fico
                currentHeightIndex = (currentHeightIndex + 1) % heightPercentages.length;
                const yPosition = height * heightPercentages[currentHeightIndex];
                
                // Altura da linha at√© o ponto
                const lineHeight = yPosition;
                
                // Ponto com cor e tamanho baseado no tipo e import√¢ncia
                const dotColor = milestone.type === 'marco-importante' ? 'var(--rosa-pink)' :
                               milestone.type === 'vacinacao' ? 'var(--verde-consultoria)' :
                               milestone.type === 'flexibilizacao' ? 'var(--azul-royal)' :
                               'var(--salmao)';
                
                // Tamanhos diferentes baseados na import√¢ncia
                const dotSize = milestone.type === 'marco-importante' ? 10 :
                              milestone.type === 'vacinacao' ? 8 :
                              6;
                
                // Criar grupo individual para cada milestone
                const individualGroup = milestoneGroup.append('g')
                    .attr('class', 'milestone-group')
                    .style('cursor', 'pointer');
                
                // Linha vertical at√© o ponto
                individualGroup.append('line')
                    .attr('class', 'milestone-line')
                    .attr('x1', x)
                    .attr('x2', x)
                    .attr('y1', lineHeight)
                    .attr('y2', height)
                    .style('stroke-width', 1)
                    .style('opacity', 0.3);
                
                // Ponto posicionado na altura calculada
                individualGroup.append('circle')
                    .attr('class', `milestone-dot ${milestone.type}`)
                    .attr('cx', x)
                    .attr('cy', lineHeight)
                    .attr('r', dotSize)
                    .style('fill', dotColor)
                    .style('stroke', 'var(--off-white)')
                    .style('stroke-width', 2)
                    .style('opacity', 1);

                // Label posicionado pr√≥ximo ao ponto
                const labelText = milestone.title;
                const labelX = x + 15;
                const labelY = lineHeight - 5;
                
                // Background do label para melhor legibilidade
                const textWidth = labelText.length * 6.5;
                individualGroup.append('rect')
                    .attr('class', 'milestone-label-bg')
                    .attr('x', labelX - 2)
                    .attr('y', labelY - 12)
                    .attr('width', textWidth + 10)
                    .attr('height', 16);
                
                individualGroup.append('text')
                    .attr('class', 'milestone-label')
                    .attr('x', labelX)
                    .attr('y', labelY)
                    .attr('text-anchor', 'start')
                    .text(labelText)
                    .style('pointer-events', 'none');
                
                // Adicionar evento de hover no grupo todo
                individualGroup
                    .on('mouseover', (event) => showTooltip(event, milestone))
                    .on('mouseout', hideTooltip);
            });
        });

        // === TOOLTIP ===
        const tooltip = d3.select('#tooltip');

        function showTooltip(event, data) {
            let content = '';
            if (data.title) {
                // Marco governamental
                content = `
                    <div class="tooltip-title">${data.title}</div>
                    <div class="tooltip-content">
                        <strong>Data:</strong> ${data.date.toLocaleDateString('pt-BR')}<br>
                        <strong>Descri√ß√£o:</strong> ${data.description}
                    </div>
                `;
            } else {
                // Ponto de dados COVID
                content = `
                    <div class="tooltip-title">Dados COVID-19</div>
                    <div class="tooltip-content">
                        <strong>Data:</strong> ${data.date.toLocaleDateString('pt-BR')}<br>
                        <strong>Casos (M√©dia 7d):</strong> ${data.casos_media7d.toLocaleString('pt-BR')}<br>
                        <strong>√ìbitos (M√©dia 7d):</strong> ${data.obitos_media7d.toLocaleString('pt-BR')}
                    </div>
                `;
            }
            
            tooltip.html(content)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 10) + 'px')
                .classed('show', true);
        }

        function hideTooltip() {
            tooltip.classed('show', false);
        }

        // === CONTROLES DE TOGGLE ===
        let showCasos = true;
        let showMortes = true;
        let showMarcos = true;

        function updateVisualization() {
            // Atualizar linhas
            g.select('.line-casos')
                .transition()
                .duration(300)
                .style('opacity', showCasos ? 0.9 : 0);
            
            g.select('.line-mortes')
                .transition()
                .duration(300)
                .style('opacity', showMortes ? 0.9 : 0);

            // Atualizar pontos de dados
            g.selectAll('.data-point-casos')
                .style('display', showCasos ? 'block' : 'none');
            
            g.selectAll('.data-point-mortes')
                .style('display', showMortes ? 'block' : 'none');

            // Atualizar eixos
            yAxisCasosGroup
                .transition()
                .duration(300)
                .style('opacity', showCasos ? 0.6 : 0);
            
            yAxisMortesGroup
                .transition()
                .duration(300)
                .style('opacity', showMortes ? 0.6 : 0);

            // Atualizar labels dos eixos
            yAxisCasosLabel
                .transition()
                .duration(300)
                .style('opacity', showCasos ? 0.9 : 0);
            
            yAxisMortesLabel
                .transition()
                .duration(300)
                .style('opacity', showMortes ? 0.9 : 0);

            // Atualizar grid
            gridCasos
                .transition()
                .duration(300)
                .style('opacity', showCasos ? 1 : 0);

            // Atualizar marcos
            milestoneGroup
                .transition()
                .duration(300)
                .style('opacity', showMarcos ? 1 : 0);

            // Atualizar legenda
            document.querySelector('.legend-casos').style.opacity = showCasos ? '1' : '0.3';
            document.querySelector('.legend-mortes').style.opacity = showMortes ? '1' : '0.3';
            document.querySelector('.legend-marcos').style.opacity = showMarcos ? '1' : '0.3';
        }

        document.getElementById('toggle-casos').addEventListener('click', function() {
            showCasos = !showCasos;
            this.classList.toggle('active', showCasos);
            updateVisualization();
        });

        document.getElementById('toggle-mortes').addEventListener('click', function() {
            showMortes = !showMortes;
            this.classList.toggle('active', showMortes);
            updateVisualization();
        });

        document.getElementById('toggle-marcos').addEventListener('click', function() {
            showMarcos = !showMarcos;
            this.classList.toggle('active', showMarcos);
            updateVisualization();
        });

        // === ESTAT√çSTICAS ===
        // Statistical calculations (elements removed from UI)
        const totalCasos = covidData.reduce((sum, d) => sum + d.casos_media7d, 0);
        const totalMortes = covidData.reduce((sum, d) => sum + d.obitos_media7d, 0);
        const picoCasos = d3.max(covidData, d => d.casos_media7d);

        // === NAVEGA√á√ÉO TEMPORAL SIMPLES ===
        let currentEndIndex = covidData.length - 1;
        const slider = document.getElementById('timeline-slider');
        const currentDateLabel = document.getElementById('current-date');

        // Fun√ß√£o para atualizar o gr√°fico com acumula√ß√£o de dados
        function updateTimeRange(progress) {
            console.log('updateTimeRange chamada com progress:', progress);
            console.log('g existe?', !!g);
            console.log('lineCasos existe?', !!lineCasos);
            console.log('lineMortes existe?', !!lineMortes);
            
            const totalPoints = covidData.length;
            currentEndIndex = Math.max(1, Math.floor(progress * totalPoints));
            
            // Sempre come√ßar do in√≠cio (acumular dados)
            const filteredData = covidData.slice(0, currentEndIndex + 1);
            
            // Atualizar label de data
            if (currentDateLabel && filteredData.length > 0) {
                const currentDate = filteredData[filteredData.length - 1].date;
                currentDateLabel.textContent = currentDate.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' });
            }
            
            // Manter as escalas fixas para preservar a propor√ß√£o
            // Apenas atualizar as linhas e pontos
            
            // Atualizar linhas de casos
            if (g && lineCasos) {
                g.select('.line-casos')
                    .datum(filteredData)
                    .transition()
                    .duration(100)
                    .attr('d', lineCasos);
            }

            // Atualizar linhas de mortes
            if (g && lineMortes) {
                g.select('.line-mortes')
                    .datum(filteredData)
                    .transition()
                    .duration(100)
                    .attr('d', lineMortes);
            }

            // Atualizar pontos de casos
            const updatedCasosPoints = g.selectAll('.data-point-casos')
                .data(filteredData, d => d.date);

            updatedCasosPoints.exit().remove();
            
            updatedCasosPoints.enter()
                .append('circle')
                .attr('class', 'data-point data-point-casos')
                .attr('r', 0)
                .attr('cx', d => xScale(d.date))
                .attr('cy', d => yScaleCasos(d.casos_media7d))
                .on('mouseover', (event, d) => showTooltip(event, d))
                .on('mouseout', hideTooltip)
                .transition()
                .duration(200)
                .attr('r', 4);

            // Atualizar pontos de mortes
            const updatedMortesPoints = g.selectAll('.data-point-mortes')
                .data(filteredData, d => d.date);

            updatedMortesPoints.exit().remove();
            
            updatedMortesPoints.enter()
                .append('circle')
                .attr('class', 'data-point data-point-mortes')
                .attr('r', 0)
                .attr('cx', d => xScale(d.date))
                .attr('cy', d => yScaleMortes(d.obitos_media7d))
                .on('mouseover', (event, d) => showTooltip(event, d))
                .on('mouseout', hideTooltip)
                .transition()
                .duration(200)
                .attr('r', 4);

            // Atualizar marcos vis√≠veis (acumulados)
            const visibleMilestones = milestones.filter(m => 
                m.date <= filteredData[filteredData.length - 1].date
            );

            // Limpar e recriar marcos
            milestoneGroup.selectAll('*').remove();
            
            // Renderizar marcos filtrados com layout inteligente
            const groupedMilestones = [];
            let currentGroup = [];
            
            visibleMilestones.forEach((milestone, i) => {
                if (i === 0) {
                    currentGroup.push(milestone);
                } else {
                    const prevX = xScale(visibleMilestones[i-1].date);
                    const currX = xScale(milestone.date);
                    
                    if (currX - prevX < 100) {
                        currentGroup.push(milestone);
                    } else {
                        if (currentGroup.length > 0) {
                            groupedMilestones.push(currentGroup);
                        }
                        currentGroup = [milestone];
                    }
                }
            });
            if (currentGroup.length > 0) {
                groupedMilestones.push(currentGroup);
            }

            // Sistema de posicionamento dentro do gr√°fico
            const heightPercentages = [0.15, 0.25, 0.35, 0.45, 0.20, 0.30, 0.40, 0.50];
            let currentHeightIndex = 0;
            
            // Renderizar grupos de marcos
            groupedMilestones.forEach((group, groupIndex) => {
                group.forEach((milestone, indexInGroup) => {
                    const x = xScale(milestone.date);
                    
                    // Alternar entre diferentes alturas
                    currentHeightIndex = (currentHeightIndex + 1) % heightPercentages.length;
                    const yPosition = height * heightPercentages[currentHeightIndex];
                    
                    // Criar grupo individual para cada milestone
                    const individualGroup = milestoneGroup.append('g')
                        .attr('class', 'milestone-group')
                        .style('cursor', 'pointer');
                    
                    // Linha vertical do ponto at√© a base
                    individualGroup.append('line')
                        .attr('class', 'milestone-line')
                        .attr('x1', x)
                        .attr('x2', x)
                        .attr('y1', yPosition)
                        .attr('y2', height)
                        .style('stroke-width', 1)
                        .style('opacity', 0)
                        .transition()
                        .duration(300)
                        .style('opacity', 0.3);

                    // Cor do marco
                    const dotColor = milestone.type === 'marco-importante' ? 'var(--rosa-pink)' :
                                   milestone.type === 'vacinacao' ? 'var(--verde-consultoria)' :
                                   milestone.type === 'flexibilizacao' ? 'var(--azul-royal)' :
                                   'var(--salmao)';
                    
                    // Tamanho do ponto
                    const dotSize = milestone.type === 'marco-importante' ? 10 :
                                  milestone.type === 'vacinacao' ? 8 :
                                  6;
                    
                    // Ponto do marco na altura calculada
                    individualGroup.append('circle')
                        .attr('class', `milestone-dot ${milestone.type}`)
                        .attr('cx', x)
                        .attr('cy', yPosition)
                        .attr('r', 0)
                        .style('fill', dotColor)
                        .style('stroke', 'var(--off-white)')
                        .style('stroke-width', 2)
                        .style('opacity', 1)
                        .transition()
                        .duration(300)
                        .attr('r', dotSize);

                    // Background do label
                    const labelText = milestone.title;
                    const labelX = x + 15;
                    const labelY = yPosition - 5;
                    const textWidth = labelText.length * 6.5;
                    
                    individualGroup.append('rect')
                        .attr('class', 'milestone-label-bg')
                        .attr('x', labelX - 2)
                        .attr('y', labelY - 12)
                        .attr('width', textWidth + 10)
                        .attr('height', 16)
                        .style('opacity', 0)
                        .transition()
                        .duration(300)
                        .delay(50)
                        .style('opacity', 1);
                    
                    // Label
                    individualGroup.append('text')
                        .attr('class', 'milestone-label')
                        .attr('x', labelX)
                        .attr('y', labelY)
                        .attr('text-anchor', 'start')
                        .text(labelText)
                        .style('opacity', 0)
                        .style('pointer-events', 'none')
                        .transition()
                        .duration(300)
                        .delay(50)
                        .style('opacity', 0.7);
                    
                    // Adicionar evento de hover no grupo todo
                    individualGroup
                        .on('mouseover', (event) => showTooltip(event, milestone))
                        .on('mouseout', hideTooltip);
                });
            });

            // Dados atualizados no gr√°fico
        }

        // Criar as linhas do gr√°fico ANTES de chamar updateTimeRange
        // Isso garante que as linhas existam quando o slider for usado
        
        // Event listener para o slider
        if (slider) {
            slider.addEventListener('input', function() {
                const progress = parseInt(this.value) / 100;
                updateTimeRange(progress);
                updateVisualization();
            });
        }
        
        // Inicializar com dados completos DEPOIS de criar as linhas
        setTimeout(() => {
            updateTimeRange(1.0);
            updateVisualization(); // Garantir que marcos sejam vis√≠veis
        }, 100);

        console.log('Timeline COVID-19 com controle temporal simplificado carregada!');
    </script>
</body>
</html>